

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Record and Playback (New) - WireMock</title>







<meta name="description" content="Recording HTTP exchanges with other APIs and playing them back as stubs - the new way.">

<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="WireMock">
<meta property="og:title" content="Record and Playback (New)">




  <meta property="og:description" content="Recording HTTP exchanges with other APIs and playing them back as stubs - the new way.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-02-02T20:36:29+00:00">
  
    <link rel="next" href="/docs/request-matching/" title="Request Matching">
  
  
    <link rel="prev" href="/docs/record-playback-legacy/" title="Record and Playback (Legacy)">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Tom Akehurst",
      "url" : null,
      "sameAs" : null
    }
  </script>






<!-- end SEO -->





  <!-- Google Analytics -->
<style>.async-hide { opacity: 0 !important} </style>
<!--<script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;-->
  <!--h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};-->
  <!--(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;-->
<!--})(window,document.documentElement,'async-hide','dataLayer',4000,-->
  <!--{'GTM-WQTGSSM':true});</script>-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36386229-2', 'auto');
  ga('require', 'GTM-WQTGSSM');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->




<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="WireMock Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<link href="https://fonts.googleapis.com/css?family=Lato|Source+Code+Pro|Cairo" rel="stylesheet">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon3.png">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg">
            <a href="/"><img src="/images/wiremock-concept-icon-01.png" style="width: 80px; height: 37px" /></a>
          </li>
          
            

            
            <li class="masthead__menu-item"><a href="/docs/" title="Docs">Docs</a></li>
            

          
            

            
            <li class="masthead__menu-item"><a href="/about/" title="About">About</a></li>
            

          
            

            
            <li class="masthead__menu-item"><a href="https://github.com/tomakehurst/wiremock" title="GitHub" target="_blank">GitHub</a></li>
            

          
            

            
            <li class="masthead__menu-item"><a href="https://groups.google.com/forum/#!forum/wiremock-user" title="Mailing List" target="_blank">Mailing List</a></li>
            

          
            

            
            <li class="masthead__menu-item"><a href="/external-resources/" title="External Resources">External Resources</a></li>
            

          

          <li class="masthead__menu-item">
            <a href="http://get.mocklab.io/?utm_source=wiremock.org&utm_medium=primary-nav&utm_campaign=mocklab" title="MockLab" target="_blank">
              <img src="/images/mocklab_logo_transparent.png" style="height: 23px; width: auto; margin-right: 5px; vertical-align: top;" />
              MockLab
            </a>
          </li>
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    

<div id="main" role="main">
  


<div class="sidebar sticky">
  <nav class="nav__list">

    <ul>
      

      
      <li>
        <a href="/docs/getting-started/">

        Getting Started
      </a>
      
      <li>
        <a href="/docs/download-and-installation/">

        Download and Installation
      </a>
      
      <li>
        <a href="/docs/junit-extensions/">

        JUnit 4 and Vintage Usage
      </a>
      
      <li>
        <a href="/docs/junit-jupiter/">

        JUnit 5+ Jupiter Usage
      </a>
      
      <li>
        <a href="/docs/java-usage/">

        Java (Non-JUnit) Usage
      </a>
      
      <li>
        <a href="/docs/configuration/">

        Configuration
      </a>
      
      <li>
        <a href="/docs/running-standalone/">

        Running as a Standalone Process
      </a>
      
      <li>
        <a href="/docs/running-without-http-server/">

        Running without the HTTP Server
      </a>
      
      <li>
        <a href="/docs/docker/">

        Running in Docker
      </a>
      
      <li>
        <a href="/docs/stubbing/">

        Stubbing
      </a>
      
      <li>
        <a href="/docs/verifying/">

        Verifying
      </a>
      
      <li>
        <a href="/docs/request-matching/">

        Request Matching
      </a>
      
      <li>
        <a href="/docs/proxying/">

        Proxying
      </a>
      
      <li>
        <a href="/docs/multi-domain-mocking/">

        Multi-domain Mocking
      </a>
      
      <li>
        <a href="/docs/record-playback/" class="nav__list-item--selected">
        

        Record and Playback (New)
      </a>
      
      <li>
        <a href="/docs/record-playback-legacy/">

        Record and Playback (Legacy)
      </a>
      
      <li>
        <a href="/docs/response-templating/">

        Response Templating
      </a>
      
      <li>
        <a href="/docs/simulating-faults/">

        Simulating Faults
      </a>
      
      <li>
        <a href="/docs/stateful-behaviour/">

        Stateful Behaviour
      </a>
      
      <li>
        <a href="/docs/https/">

        HTTPS
      </a>
      
      <li>
        <a href="/docs/webhooks-and-callbacks/">

        Webhooks and Callbacks
      </a>
      
      <li>
        <a href="/docs/extending-wiremock/">

        Extending WireMock
      </a>
      
      <li>
        <a href="/docs/android/">

        Android
      </a>
      
      <li>
        <a href="/docs/spring-boot/">

        Spring Boot
      </a>
      
      <li>
        <a href="/docs/stub-metadata/">

        Stub Metadata
      </a>
      
      <li>
        <a href="/docs/api/">

        Admin API Reference
      </a>
      
    </ul>
  </nav>
</div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Record and Playback (New)">
    <meta itemprop="description" content="       If you want to record stubs and host them in the cloud with minimum hassle, try MockLab. It provides a hosted, 100% WireMock compatible mocking service with a friendly web UI.        Learn more">
    <meta itemprop="datePublished" content="February 02, 2022">
    

    <div class="page__inner-wrap">
      <header>
        <h1 class="page__title" itemprop="headline">Record and Playback (New)
</h1>
      </header>

      <section class="page__content" itemprop="text">
        <div class="mocklab-callout"> 
  <p class="mocklab-callout__text">
    If you want to record stubs and host them in the cloud with minimum hassle, try <strong>MockLab</strong>. It provides a hosted, 100% WireMock compatible mocking service with a friendly web UI.    
  </p>
  <a href="http://get.mocklab.io/?utm_source=wiremock.org&amp;utm_medium=docs-callout&amp;utm_campaign=record-and-playback" title="Learn more" class="mocklab-callout__learn-more-button">Learn more</a>
</div>

<p>WireMock can create stub mappings from requests it has received. Combined with its proxying feature this allows you to “record”
stub mappings from interaction with existing APIs.</p>

<p>Two approaches are available: Recording or snapshotting. The same results can be achieved with either, so which you choose should depend on whatever
fits best with your workflow. If you’re new to WireMock, recording is probably the simplest option for getting started.</p>

<p>Both approaches are described in more detail below.</p>

<h2 id="quick-start">Quick start</h2>

<p>The fastest way to get started with WireMock’s recorder is to use the simple web UI provided.</p>

<p>First, start an instance of <a href="/docs/running-standalone">WireMock running standalone</a>.
Once that’s running visit the recorder UI page at <a href="http://localhost:8080/__admin/recorder">http://localhost:8080/__admin/recorder</a>
(assuming you started WireMock on the default port of 8080).</p>

<p><img src="/images/recorder-screenshot.png" alt="Recorder UI" /></p>

<p>Enter the URL you wish to record from in the target URL field and click the Record button. You can use <code class="language-plaintext highlighter-rouge">http://example.mocklab.io</code> to try it out.</p>

<p>Now you need to make a request through WireMock to the target API so that it can be recorded. If you’re using the example URL, you can generate a request using curl:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://localhost:8080/recordables/123
</code></pre></div></div>

<p>Now click stop. You should see a message indicating that one stub was captured.</p>

<p>You should also see that a file has been created called something like <code class="language-plaintext highlighter-rouge">recordables_123-40a93c4a-d378-4e07-8321-6158d5dbcb29.json</code>
under the <code class="language-plaintext highlighter-rouge">mappings</code> directory created when WireMock started up, and that a new mapping has appeared at <a href="http://localhost:8080/__admin/mappings">http://localhost:8080/__admin/mappings</a>.</p>

<p>Requesting the same URL again (possibly disabling your wifi first if you want firm proof) will now serve the recorded result:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost:8080/recordables/123

{
  "message": "Congratulations on your first recording!"
}
</code></pre></div></div>

<blockquote>
  <p><strong>note</strong></p>

  <p>Stub mappings will only be created at the point that the recording is stopped.</p>
</blockquote>

<blockquote>
  <p><strong>note</strong></p>

  <p>“Playback” doesn’t require any explicit action. Recorded stubs will start being served immediately after recording is stopped.</p>
</blockquote>

<h2 id="recording">Recording</h2>

<p>Recording can also be started and stopped via WireMock’s JSON API and Java DSL.</p>

<p>Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Static DSL</span>
<span class="nc">WireMock</span><span class="o">.</span><span class="na">startRecording</span><span class="o">(</span><span class="s">"http://example.mocklab.io"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="nc">WireMock</span><span class="o">.</span><span class="na">stopRecording</span><span class="o">();</span>

<span class="c1">// Client instance</span>
<span class="nc">WireMock</span> <span class="n">wireMockClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WireMock</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
<span class="n">wireMockClient</span><span class="o">.</span><span class="na">startStubRecording</span><span class="o">(</span><span class="s">"http://example.mocklab.io"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="n">wireMockClient</span><span class="o">.</span><span class="na">stopStubRecording</span><span class="o">();</span>

<span class="c1">// Directly</span>
<span class="nc">WireMockServer</span> <span class="n">wireMockServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WireMockServer</span><span class="o">();</span>
<span class="n">wireMockServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="n">wireMockServer</span><span class="o">.</span><span class="na">startRecording</span><span class="o">(</span><span class="s">"http://example.mocklab.io"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="n">wireMockServer</span><span class="o">.</span><span class="na">stopRecording</span><span class="o">();</span>
</code></pre></div></div>

<p>API:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/__admin/recordings/start</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"targetBaseUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.mocklab.io"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /__admin/recordings/stop
</code></pre></div></div>

<h2 id="snapshotting">Snapshotting</h2>

<p>Snapshotting is effectively “recording after the fact”. Rather than starting recording at a specific point, snapshotting allows you to convert requests already received by WireMock
into stub mappings.</p>

<p>An implication of this order of events is that if you want to record an external API, you’ll need to have configured proxying before you start generating traffic.
See <a href="/docs/proxying">Proxying</a> for details on proxy configuration, but in summary this can be achieved by creating a proxy mapping via the API or Java DSL:</p>

<p>Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stubFor</span><span class="o">(</span><span class="n">proxyAllTo</span><span class="o">(</span><span class="s">"http://example.mocklab.io"</span><span class="o">).</span><span class="na">atPriority</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
</code></pre></div></div>

<p>API:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/__admin/mappings</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"priority"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"proxyBaseUrl"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.mocklab.io"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p><strong>note</strong></p>

  <p>You can still take snapshots without a proxy stub configured.
You might want to do this e.g. if you want to capture requests made by your application under test that you can then modify by hand to provide the appropriate responses.</p>
</blockquote>

<p>Once you have made some requests through WireMock (which you can view under http://localhost:8080/__admin/requests) you can trigger a snapshot to generate stub mappings:</p>

<p>Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Static DSL</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="nc">WireMock</span><span class="o">.</span><span class="na">snapshotRecord</span><span class="o">();</span>

<span class="c1">// Client instance</span>
<span class="nc">WireMock</span> <span class="n">wireMockClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WireMock</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="n">wireMockClient</span><span class="o">.</span><span class="na">takeSnapshotRecording</span><span class="o">();</span>

<span class="c1">// Directly</span>
<span class="nc">WireMockServer</span> <span class="n">wireMockServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WireMockServer</span><span class="o">();</span>
<span class="n">wireMockServer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StubMapping</span><span class="o">&gt;</span> <span class="n">recordedMappings</span> <span class="o">=</span> <span class="n">wireMockServer</span><span class="o">.</span><span class="na">snapshotRecord</span><span class="o">();</span>
</code></pre></div></div>

<p>API:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /__admin/recordings/snapshot
{}
</code></pre></div></div>

<h2 id="customising-your-recordings">Customising your recordings</h2>

<p>The default recording behaviour can be tweaked in a number of ways by passing a “record spec” to the record or snapshot actions.</p>

<p>In Java this achieved using the DSL:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">startRecording</span><span class="o">(</span>
      <span class="n">recordSpec</span><span class="o">()</span>
          <span class="o">.</span><span class="na">forTarget</span><span class="o">(</span><span class="s">"http://example.mocklab.io"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">onlyRequestsMatching</span><span class="o">(</span><span class="n">getRequestedFor</span><span class="o">(</span><span class="n">urlPathMatching</span><span class="o">(</span><span class="s">"/api/.*"</span><span class="o">)))</span>
          <span class="o">.</span><span class="na">captureHeader</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">captureHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
          <span class="o">.</span><span class="na">extractBinaryBodiesOver</span><span class="o">(</span><span class="mi">10240</span><span class="o">)</span>
          <span class="o">.</span><span class="na">extractTextBodiesOver</span><span class="o">(</span><span class="mi">2048</span><span class="o">)</span>
          <span class="o">.</span><span class="na">makeStubsPersistent</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
          <span class="o">.</span><span class="na">ignoreRepeatRequests</span><span class="o">()</span>
          <span class="o">.</span><span class="na">transformers</span><span class="o">(</span><span class="s">"modify-response-header"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">transformerParameters</span><span class="o">(</span><span class="nc">Parameters</span><span class="o">.</span><span class="na">one</span><span class="o">(</span><span class="s">"headerValue"</span><span class="o">,</span> <span class="s">"123"</span><span class="o">))</span>
          <span class="o">.</span><span class="na">matchRequestBodyWithEqualToJson</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
  <span class="o">);</span>
</code></pre></div></div>

<p>And via the API:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/__admin/recordings/start</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"targetBaseUrl"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.mocklab.io"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"filters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"urlPathPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/.*"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"allowNonProxied"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"captureHeaders"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Accept"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"Content-Type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"caseInsensitive"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"requestBodyPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"matcher"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"equalToJson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ignoreArrayOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ignoreExtraElements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"extractBodyCriteria"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"textSizeThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2048"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"binarySizeThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"10240"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"persist"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"repeatsAsScenarios"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transformers"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"modify-response-header"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"transformerParameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"headerValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The same specification can also be passed when snapshotting:</p>

<p>Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">snapshotRecord</span><span class="o">(</span>
      <span class="n">recordSpec</span><span class="o">()</span>
          <span class="o">.</span><span class="na">onlyRequestsMatching</span><span class="o">(</span><span class="n">getRequestedFor</span><span class="o">(</span><span class="n">urlPathMatching</span><span class="o">(</span><span class="s">"/api/.*"</span><span class="o">)))</span>
          <span class="o">.</span><span class="na">onlyRequestIds</span><span class="o">(</span><span class="n">singletonList</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="s">"40a93c4a-d378-4e07-8321-6158d5dbcb29"</span><span class="o">)))</span>
          <span class="o">.</span><span class="na">allowNonProxied</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
          <span class="o">.</span><span class="na">captureHeader</span><span class="o">(</span><span class="s">"Accept"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">captureHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
          <span class="o">.</span><span class="na">extractBinaryBodiesOver</span><span class="o">(</span><span class="mi">10240</span><span class="o">)</span>
          <span class="o">.</span><span class="na">extractTextBodiesOver</span><span class="o">(</span><span class="mi">2048</span><span class="o">)</span>
          <span class="o">.</span><span class="na">makeStubsPersistent</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
          <span class="o">.</span><span class="na">ignoreRepeatRequests</span><span class="o">()</span>
          <span class="o">.</span><span class="na">transformers</span><span class="o">(</span><span class="s">"modify-response-header"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">transformerParameters</span><span class="o">(</span><span class="nc">Parameters</span><span class="o">.</span><span class="na">one</span><span class="o">(</span><span class="s">"headerValue"</span><span class="o">,</span> <span class="s">"123"</span><span class="o">))</span>
          <span class="o">.</span><span class="na">chooseBodyMatchTypeAutomatically</span><span class="o">()</span>
  <span class="o">);</span>
</code></pre></div></div>

<p>API:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">POST</span><span class="w"> </span><span class="err">/__admin/recordings/snapshot</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"filters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"urlPathPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/.*"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ids"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"40a93c4a-d378-4e07-8321-6158d5dbcb29"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"captureHeaders"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Accept"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"Content-Type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"caseInsensitive"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"requestBodyPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"matcher"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"equalToJson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ignoreArrayOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ignoreExtraElements"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"extractBodyCriteria"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"textSizeThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2 kb"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"binarySizeThreshold"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1 Mb"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"outputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FULL"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"persist"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"repeatsAsScenarios"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"transformers"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"modify-response-header"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"transformerParameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"headerValue"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The following sections will detail each parameter in turn:</p>

<h3 id="filtering">Filtering</h3>

<p><code class="language-plaintext highlighter-rouge">filters</code> supports selection of requests to be recorded according to the same <a href="/docs/request-matching">request matcher</a> format used elsewhere in WireMock.</p>

<p>Additionally, when snapshotting the <code class="language-plaintext highlighter-rouge">ids</code> parameter allows specific serve events to be selected by ID.</p>

<p>The <code class="language-plaintext highlighter-rouge">allowNonProxied</code> attribute, when set to <code class="language-plaintext highlighter-rouge">true</code> will cause requests that did not get proxied to a target service to be recorded/snapshotted. This is useful if
you wish to “teach” WireMock your API by feeding it requests from your app that initially don’t match a stub, then snapshotting to generate the correct stubs.</p>

<h3 id="capturing-request-headers">Capturing request headers</h3>

<p>You may want your recorded stub mappings to match on one or more specific request headers.
For instance if you’re intending to record from an API that supports both XML and JSON responses via content negotiation,
then you will need to capture the value of the <code class="language-plaintext highlighter-rouge">Accept</code> header sent in each request.</p>

<p>The <code class="language-plaintext highlighter-rouge">captureHeaders</code> attribute allows you to specify a map of header names to match parameter objects. Currently the only parameter
available is <code class="language-plaintext highlighter-rouge">caseInsensitive</code>, which defaults to false if absent.</p>

<h3 id="body-files-extraction-size-criteria">Body files extraction size criteria</h3>

<p>By default, recorded response bodies will be included directly in the stub mapping response part, via the <code class="language-plaintext highlighter-rouge">body</code> attribute for text or <code class="language-plaintext highlighter-rouge">base64Body</code> for binary content.</p>

<p>However, this can be overridden by setting the <code class="language-plaintext highlighter-rouge">textSizeThreshold</code> and <code class="language-plaintext highlighter-rouge">binarySizeThreshold</code> values under <code class="language-plaintext highlighter-rouge">extractBodyCriteria</code>.
The size values are of type string, and support friendly syntax for specifying the order of magnitude e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"56 kb"
"10 Mb"
"18.2 GB"
"255" // bytes when no magnitude specified
</code></pre></div></div>

<p>In the Java DSL these values are specified as a <code class="language-plaintext highlighter-rouge">long</code> number of bytes:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">recordSpec</span><span class="o">().</span><span class="na">extractBinaryBodiesOver</span><span class="o">(</span><span class="mi">204800</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="output-format">Output format</h3>

<p>By default the stop recording and snapshot API calls will return the full JSON of all mappings captured.
If you only require the IDs of captured stubs you can specify:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"outputFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IDS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="persist-stubs">Persist stubs</h3>

<p>By default generated stubs will be set to persistent, meaning that they will be saved to the file system
(or other back-end if you’ve implemented your own <code class="language-plaintext highlighter-rouge">MappingsSource</code>) and will survive calls to reset mappings to default.</p>

<p>Setting <code class="language-plaintext highlighter-rouge">persist</code> to <code class="language-plaintext highlighter-rouge">false</code> means that stubs will not be saved and will be deleted on the next reset.</p>

<h3 id="repeats-as-scenarios">Repeats as scenarios</h3>

<p>What happens when the recorder sees two identical requests that produce different results?</p>

<p>There are two ways to handle this. Setting <code class="language-plaintext highlighter-rouge">repeatsAsScenarios</code> to <code class="language-plaintext highlighter-rouge">false</code> means that after the first request, subsequent identical ones will be ignored.</p>

<p>However, when set to <code class="language-plaintext highlighter-rouge">true</code> (which is the default if omitted), multiple identical requests will be added to a <a href="/docs/stateful-behaviour">Scenario</a>, meaning that when
playing back, a series of requests matching this stub will yield the same series of responses captured during recording. If more requests are made after the end of the series
is reached, the last response will continue to be returned.</p>

<h3 id="transforming-generated-stubs">Transforming generated stubs</h3>

<p>If you need even more control over how your recorded stubs are generated, you can write one or more custom transformers that will be applied to stubs as they are captured.</p>

<p>A transformer is an implementations of <code class="language-plaintext highlighter-rouge">StubMappingTransformer</code> and needs to be registered when starting WireMock as described in <a href="/docs/extending-wiremock">Extending WireMock</a>.</p>

<p>Transformer implementations supply a name, and this is used to identify them in the <code class="language-plaintext highlighter-rouge">transformers</code> parameter e.g.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"transformers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"transformer-one"</span><span class="p">,</span><span class="w"> </span><span class="s2">"transformer-two"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>As with other types of WireMock extension, parameters can be supplied. The exact parameters required depend on the specifics of the transformer (or it may not require any).</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"transformerParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"simpleParam1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"One"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"arrayParam2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="request-body-matching">Request body matching</h3>

<p>By default, the body match operator for a recorded stub is based on the <code class="language-plaintext highlighter-rouge">Content-Type</code> header of the request. For MIME types containing the string “json”, the operator will be <code class="language-plaintext highlighter-rouge">equalToJson</code> with both the <code class="language-plaintext highlighter-rouge">ignoreArrayOrder</code> and <code class="language-plaintext highlighter-rouge">ignoreExtraElements</code> options set to <code class="language-plaintext highlighter-rouge">true</code>. For MIME types containing <code class="language-plaintext highlighter-rouge">xml</code>, it will use <code class="language-plaintext highlighter-rouge">equalToXml</code>. Otherwise, it will use <code class="language-plaintext highlighter-rouge">equalTo</code> with the <code class="language-plaintext highlighter-rouge">caseInsensitive</code> option set to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p>This behavior can be customized via the <code class="language-plaintext highlighter-rouge">requestBodyPattern</code> parameter, which accepts a <code class="language-plaintext highlighter-rouge">matcher</code> (either <code class="language-plaintext highlighter-rouge">equalTo</code>, <code class="language-plaintext highlighter-rouge">equalToJson</code>, <code class="language-plaintext highlighter-rouge">equalToXml</code>, or <code class="language-plaintext highlighter-rouge">auto</code>) and any relevant matcher options (<code class="language-plaintext highlighter-rouge">ignoreArrayOrder</code>, <code class="language-plaintext highlighter-rouge">ignoreExtraElements</code>, or <code class="language-plaintext highlighter-rouge">caseInsensitive</code>). For example, here’s how to preserve the default behavior, but set <code class="language-plaintext highlighter-rouge">ignoreArrayOrder</code> to <code class="language-plaintext highlighter-rouge">false</code> when <code class="language-plaintext highlighter-rouge">equalToJson</code> is used:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"requestBodyPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"matcher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ignoreArrayOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If you want to always match request bodies with <code class="language-plaintext highlighter-rouge">equalTo</code> case-insensitively, regardless of the MIME type, use:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"requestBodyPattern"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"matcher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"equalTo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"caseInsensitive"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p><strong>note</strong></p>

  <p>The <code class="language-plaintext highlighter-rouge">targetBaseUrl</code> parameter will be ignored when snapshotting and the <code class="language-plaintext highlighter-rouge">filters/ids</code> parameter will be ignored when recording.</p>
</blockquote>


        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
    <li><strong>Follow:</strong></li>
    
    
    
    
    
    <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2022 Tom Akehurst. Powered by <a href="http://jekyllrb.com"
                                                                                                                                                                  rel="nofollow">Jekyll</a> &amp; <a
  href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.
</div>

<div id="dialog" style="display: none">
  <h2 class="mocklab-popup__title">Looking for super-quick hosted mocks? Try MockLab</h2>
  <p>Instant mock services on your own public URL, zero code required. Paste, record and generate mock data. Tester-friendly UI.</p>
</div>



<script type="text/javascript">


  function setNotificationSeenCookie() {
    var expiresDate = new Date();
    expiresDate.setTime(expiresDate.getTime() + (30 * 86400000));
    document.cookie = "mocklab_notification_seen=true;expires=" + expiresDate.toGMTString() + ";path=/";
  }



  function sendNavigatedToMockLabEvent(location) {
    ga('send', 'event', location, 'navigated_to_mocklab', 'Navigated to MockLab', 1);
  }

  window.onload = function () {
    $("a[title='MockLab']").click(function() {
      ga('send', 'event', 'primary_nav', 'mocklab_clicked', 'MockLab clicked', 1);
      sendNavigatedToMockLabEvent('primary_nav');
    });

    $("a[title='Consulting Services']").click(function() {
      ga('send', 'event', 'primary_nav', 'consulting_services_clicked', 'Consulting Services clicked', 1);
    });



    if (!document.cookie.includes('mocklab_notification_seen') && !window.suppressMockLabPopover) {
      window.setTimeout(function () {
        $("#dialog").dialog({
          dialogClass: 'mocklab-popup',
          draggable: false,
          resizable: false,
          modal: true,
          show: {
            effect: 'fade',
            duration: 1000
          },
          buttons: [{
            class: 'mocklab-popup__confirm-button',
            text: "Learn More",
            click: function () {
              ga('send', 'event', 'mocklab_popup', 'learn_more_clicked', 'Learn More clicked', 1);
              sendNavigatedToMockLabEvent();
              window.location.href = "http://get.mocklab.io/?utm_source=wiremock.org&utm_medium=mocklab-popup&utm_campaign=mocklab"
            }
          }]
        });

        setNotificationSeenCookie();
        ga('send', 'event', 'mocklab_popup', 'mocklab_popup_seen', 'MockLab popup seen', 0);
      }, 500);

    }

    $("#mocklab-callout-learn-more").click(function() {
      ga('send', 'event', 'mocklab_homepage_section', 'learn_more_clicked', 'Learn More clicked', 1);
      sendNavigatedToMockLabEvent('mocklab_homepage_section');
    });

    $("#mocklab-callout-try-it-now").click(function() {
      ga('send', 'event', 'mocklab_homepage_section', 'try_it_now_clicked', 'Try It Now clicked', 2);
      sendNavigatedToMockLabEvent('mocklab_homepage_section');
    });

    $("#wiremock-studio-download").click(function() {
      ga('send', 'event', 'wiremock_studio_beta_doc', 'download_link_clicked', 'Download clicked', 3);
    });
  };
</script>

      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




  </body>
</html>

